<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>”®–Ω”©”©–¥—Ä–∏–π–Ω —Ü–∞–≥ –∞–≥–∞–∞—Ä ‚Äî –û–î–û–û</title>

  <!-- ‚úÖ Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    :root {
      --sunny-1: #87CEEB;
      --sunny-2: #E0F6FF;
      --cloudy-1: #B0C4DE;
      --cloudy-2: #A9A9A9;
      --rain-1: #89f7fe;
      --rain-2: #66a6ff;
      --night-1: #1A2A44;
      --night-2: #2E4066;
      --text-light: #fff;
      --radius: 16px;
    }

    body {
      margin: 0;
      font-family: "Poppins", Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      transition: background 1s ease;
      color: #fff;
      background: linear-gradient(135deg, var(--cloudy-1), var(--cloudy-2));
    }

    .day.clear { background: linear-gradient(135deg, var(--sunny-1), var(--sunny-2)); }
    .day.clouds { background: linear-gradient(135deg, var(--cloudy-1), var(--cloudy-2)); }
    .day.rain { background: linear-gradient(135deg, var(--rain-1), var(--rain-2)); }

    .night.clear, .night.clouds, .night.rain {
      background: linear-gradient(135deg, var(--night-1), var(--night-2));
      position: relative;
    }
    .night.clear::before, .night.clouds::before, .night.rain::before {
      content: "";
      position: absolute; inset: 0;
      background: url('https://www.transparenttextures.com/patterns/stardust.png') repeat;
      opacity: 0.5; z-index: 1;
    }
    .night * { position: relative; z-index: 2; }

    h1 {
      margin-top: 30px; text-align: center; font-size: 28px; font-weight: 700;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .controls {
      margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
    }

    select, input, button {
      padding: 10px 15px; border-radius: var(--radius); border: none; outline: none; font-size: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    select, input { color: #333; background: #fff; min-width: 160px; }

    button {
      background: linear-gradient(135deg, #43cea2, #185a9d); color: #dfd4d4; cursor: pointer; font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

    #error { margin-top: 10px; background: rgba(255, 0, 0, 0.2); color: #fff; padding: 10px 20px; border-radius: var(--radius); display: none; }
    #loading { margin-top: 10px; font-weight: 500; }

    .weather-container { margin-top: 40px; display: grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 15px; padding: 10px; width: 90%; }

    .weather-card {
      background: rgba(255,255,255,0.15); border-radius: var(--radius); padding: 18px; text-align: center; backdrop-filter: blur(8px);
      box-shadow: 0 6px 16px rgba(7, 4, 4, 0.25); transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .weather-card:hover { transform: translateY(-6px); box-shadow: 0 10px 20px rgba(0,0,0,0.35); }
    .weather-card img { width: 80px; height: auto; }
    .weather-card h4 { margin: 10px 0 5px; font-size: 18px; font-weight: 700; color: #fff; }
    .weather-card p { margin: 6px 0; font-size: 14px; color: #eee; }

    #message { margin-top: 20px; padding: 10px 20px; border-radius: var(--radius); font-size: 15px; font-weight: 600; background: rgba(31, 47, 93, 0.2); backdrop-filter: blur(6px); opacity: 0; transform: translateY(10px); transition: all 0.6s ease; }
    #message.show { opacity: 1; transform: translateY(0); }

    #map { width: 90%; height: 320px; margin-top: 30px; border-radius: var(--radius); box-shadow: 0 5px 20px rgba(0,0,0,0.4); z-index: 0; }
  </style>
</head>
<body>
  <h1>üå§Ô∏è ”®–Ω”©”©–¥—Ä–∏–π–Ω —Ü–∞–≥ –∞–≥–∞–∞—Ä ‚Äî –û–¥–æ–æ–≥–∏–π–Ω</h1>

  <div class="controls">
    <select id="citySelect">
      <option value="Ulaanbaatar,mn">–£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä</option>
      <option value="Erdenet,mn">–≠—Ä–¥—ç–Ω—ç—Ç</option>
      <option value="Tokyo,jp">–¢–æ–∫–∏–æ</option>
      <option value="London,uk">–õ–æ–Ω–¥–æ–Ω</option>
      <option value="New York,us">–ù—å—é –ô–æ—Ä–∫</option>
      <option value="Paris,fr">–ü–∞—Ä–∏—Å</option>
    </select>
    <input id="cityInput" type="text" placeholder="–•–æ—Ç –æ—Ä—É—É–ª–∞—Ö (–∂–∏—à—ç—ç: Darkhan,mn)">
    <button id="fetchBtn">–ú—ç–¥—ç—ç–ª—ç–ª –∞–≤–∞—Ö</button>
  </div>

  <div id="error"></div>
  <div id="loading" style="display:none;">–ú—ç–¥—ç—ç–ª—ç–ª –∞–≤—á –±–∞–π–Ω–∞...</div>

  <div class="weather-container" id="weatherContainer">
    <p>–•–æ—Ç –æ—Ä—É—É–ª–∞–∞–¥ –º—ç–¥—ç—ç–ª—ç–ª –∞–≤–∞–∞—Ä–∞–π.</p>
  </div>

  <div id="map"></div>

  <div id="message"></div>

  <!-- ‚úÖ Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // üîë ”®”©—Ä–∏–π–Ω OpenWeatherMap API —Ç“Ø–ª—Ö“Ø“Ø—Ä—ç—ç —ç–Ω–¥ –æ—Ä—É—É–ª
    const apiKey = 'f6f84ebdae74fb2148fc8ed524056541';

    const btn = document.getElementById('fetchBtn');
    const errorDiv = document.getElementById('error');
    const loadingDiv = document.getElementById('loading');
    const weatherContainer = document.getElementById('weatherContainer');
    const messageBox = document.getElementById('message');
    const body = document.body;

    // üåç Leaflet –≥–∞–∑—Ä—ã–Ω –∑—É—Ä–∞–≥
    const map = L.map('map').setView([47.92, 106.92], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    let marker;

    btn.addEventListener('click', getWeather);

    async function getWeather() {
      const city = document.getElementById('cityInput').value.trim() || document.getElementById('citySelect').value;
      if (!city) return;

      showError('');
      showLoading(true);
      weatherContainer.innerHTML = '';
      messageBox.classList.remove('show');

      // ‚õÖ –û–î–û–û–ì–ò–ô–ù —Ü–∞–≥ –∞–≥–∞–∞—Ä—ã–Ω endpoint
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=mn`;

      try {
        const res = await fetch(url);
        if (!res.ok) {
          if (res.status === 401) throw new Error("API —Ç“Ø–ª—Ö“Ø“Ø—Ä—ç—ç —à–∞–ª–≥–∞–Ω–∞ —É—É (401)");
          if (res.status === 404) throw new Error("–•–æ—Ç –æ–ª–¥—Å–æ–Ω–≥“Ø–π");
          throw new Error("HTTP –∞–ª–¥–∞–∞: " + res.status);
        }
        const data = await res.json();
        showWeather(data);
        showMap(data.coord.lat, data.coord.lon, data.name);
      } catch (err) {
        showError(err.message);
      } finally {
        showLoading(false);
      }
    }

    function showLoading(show) {
      loadingDiv.style.display = show ? "block" : "none";
    }

    function showError(msg) {
      errorDiv.textContent = msg;
      errorDiv.style.display = msg ? "block" : "none";
    }

    function showWeather(data) {
      const weatherType = (data.weather?.[0]?.main || '').toLowerCase();
      const sunrise = (data.sys?.sunrise || 0) * 1000;
      const sunset = (data.sys?.sunset || 0) * 1000;
      const now = Date.now();
      const isDayTime = now >= sunrise && now <= sunset;
      const timeClass = isDayTime ? 'day' : 'night';
      const bgClass = `${timeClass} ${weatherType.includes('cloud') ? 'clouds' : weatherType.includes('rain') ? 'rain' : 'clear'}`;
      body.className = bgClass;

      const icon = data.weather?.[0]?.icon || '01d';
      const desc = data.weather?.[0]?.description || '';
      const temp = (data.main?.temp ?? 0).toFixed(1);
      const feels = (data.main?.feels_like ?? 0).toFixed(1);
      const wind = (data.wind?.speed ?? 0).toFixed(1);
      const humidity = data.main?.humidity ?? '-';
      const pressure = data.main?.pressure ?? '-';

      const localTime = new Date((data.dt || now) * 1000);
      const timeStr = localTime.toLocaleString('mn-MN', { hour: '2-digit', minute: '2-digit' });

      weatherContainer.innerHTML = `
        <div class="weather-card">
          <h4>${data.name} ‚Äî ${timeStr}</h4>
          <img src="https://openweathermap.org/img/wn/${icon}@4x.png" alt="icon">
          <p style="font-size:20px; font-weight:700;">üå°Ô∏è ${temp}¬∞C <span style="font-weight:500;">(–º—ç–¥—Ä—ç–≥–¥—ç—Ö: ${feels}¬∞C)</span></p>
          <p>${desc}</p>
          <p>üí® –°–∞–ª—Ö–∏: ${wind} –º/—Å</p>
          <p>üíß –ß–∏–π–≥—à–∏–ª: ${humidity}% ‚Ä¢ ‚¨á –î–∞—Ä–∞–ª—Ç: ${pressure} hPa</p>
          <p>üåÖ –ù–∞—Ä: ${new Date(sunrise).toLocaleTimeString('mn-MN',{hour:'2-digit',minute:'2-digit'})}
             ‚Ä¢ üåá –®–∏–Ω–≥—ç—Ö: ${new Date(sunset).toLocaleTimeString('mn-MN',{hour:'2-digit',minute:'2-digit'})}</p>
        </div>
      `;

      const msg = Number(temp) <= 0
        ? '‚ùÑÔ∏è –ì–∞–¥–∞–∞ —Ö“Ø–π—Ç—ç–Ω –±–∞–π–Ω–∞ —à“Ø“Ø, –¥—É–ª–∞–∞–Ω —Ö—É–≤—Ü–∞—Å–ª–∞–∞—Ä–∞–π!'
        : Number(temp) < 15
          ? 'üå• –°—ç—Ä“Ø“Ø—Ö—ç–Ω –±–∞–π–Ω–∞, —Ç–æ—Ö–∏—Ä–æ–º–∂—Ç–æ–π —Ö—É–≤—Ü–∞—Å–ª–∞–∞—Ä–∞–π.'
          : '‚òÄÔ∏è –î—É–ª–∞–∞—Ö–∞–Ω –±–∞–π–Ω–∞, ”©–¥—Ä–∏–π–≥ —Å–∞–π—Ö–∞–Ω ”©–Ω–≥”©—Ä“Ø“Ø–ª—ç—ç—Ä—ç–π!';
      messageBox.textContent = msg;
      messageBox.classList.add('show');
    }

    function showMap(lat, lon, city) {
      map.setView([lat, lon], 9);
      if (marker) marker.remove();
      marker = L.marker([lat, lon]).addTo(map).bindPopup(`üìç ${city}`).openPopup();
    }

    // üëâ –ê–Ω—Ö–¥–∞–≥—á –±–∞–π–¥–ª–∞–∞—Ä –£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª —Ç–∞—Ç–∞—Ö (—Ö“Ø—Å–≤—ç–ª –∞—Ä–∏–ª–≥–∞–∞—Ä–∞–π)
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('cityInput').value = '';
      getWeather();
    });
  </script>
</body>
</html>
